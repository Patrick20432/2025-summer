
## 一.项目简介

本项目旨在通过实现**离散余弦变换 (DCT)** 域的数字水印算法，来演示和验证图片数字水印在版权保护和泄露检测中的应用。我们成功地将一个秘密的二值图片（水印）嵌入到另一张大图片（载体图片）中。更重要的是，我们通过模拟各种常见的图像处理“攻击”，对水印的**鲁棒性**进行了全面测试，评估了在图片被修改后水印是否仍能被成功提取的能力。

本项目基于 **Python 语言**，并充分利用了 `OpenCV` 和 `NumPy` 等强大的图像处理和数值计算库。

-----

## 二.核心功能与技术实现

### 1\. **水印嵌入**

  * **目标**: 将预设的二值水印（例如公司 Logo 或用户 ID）隐藏到载体图片中。
  * **技术实现**:
      * 将载体图片转换为 **YCrCb 颜色空间**，并在亮度 (Y) 通道进行 **8x8 分块 DCT 变换**。
      * 将水印信息（映射为 -1 和 1）嵌入到每个 DCT 块的**中频系数**中，以平衡不可感知性与鲁棒性。
  * **评估指标**:
      * **PSNR (峰值信噪比)**：用于量化含水印图片与原始图片之间的失真程度。PSNR 值越高，表示水印的**不可感知性**越好。

### 2\. **水印提取**

  * **目标**: 从含水印图片（或经过攻击的图片）中准确提取出隐藏的水印信息。
  * **技术实现**:
      * 对目标图片执行与嵌入时相同的 YCrCb 转换和 **8x8 分块 DCT 变换**。
      * 从预设的相同中频系数位置提取 DCT 系数，并根据符号判决恢复水印比特，然后重构为二值水印图片。
  * **评估指标**:
      * **NCC (归一化相关系数)**：用于衡量提取出的水印与原始水印的相似度。NCC 值越接近 1，表示提取质量越好，水印的**鲁棒性**越强。

### 3\. **图像攻击模拟**

  * **目标**: 模拟图片在真实传输和使用过程中可能遭遇的各种图像处理操作，以全面测试水印的抵抗能力。
  * **攻击类型**:
      * **几何攻击**: 翻转（水平/垂直/水平垂直）、平移、旋转、裁剪。
      * **信号处理攻击**: 亮度/对比度调整、JPEG 压缩。

-----

## 三.项目结构

```
DigitalWatermarking/
├── src/
│   ├── watermark_embedder.py      # 水印嵌入的核心逻辑（DCT 域实现）
│   ├── watermark_extractor.py     # 水印提取的核心逻辑（DCT 域实现）
│   ├── image_attacks.py           # 模拟各种图像处理攻击
│   └── utils.py                   # 辅助函数：图片读写、PSNR/NCC 计算等
│
├── data/
│   ├── original_images/           # 存放原始载体图片（例如 fruits.png）
│   └── watermarks/                # 存放原始水印图片（例如 my_watermark.png）
│
├── results/                       # 实验结果输出目录
│   ├── watermarked_images/        # 嵌入水印后的图片
│   ├── attacked_images/           # 经过各种攻击后的图片
│   ├── extracted_watermarks/      # 从攻击图片中提取出的水印
│   └── performance_reports/       # 性能报告和图表
│
├── main.py                        # 项目主入口，协调整个实验流程
└── README.md                      # 项目说明文件 (当前文件)
```

-----

## 四.环境准备与运行

### 1\. **环境依赖**

确保系统已安装 **Python 3.8 或更高版本**。然后，通过 `pip` 安装以下必要的 Python 库：

```bash
pip install opencv-python numpy matplotlib pillow
```

### 2\. **数据准备**

  * **载体图片**: 将你选择的原始载体图片（推荐 `fruits.png`）放入 `data/original_images/` 目录。
  * **水印图片**: 运行 `data/watermarks/generate_watermark.py` 脚本来自动生成一个示例水印。

### 3\. **运行项目**

打开命令行终端，导航到项目的**根目录** (`DigitalWatermarking/`)，然后执行以下命令：

```bash
python main.py
```

程序将自动执行完整的实验流程，并生成鲁棒性测试结果的柱状图。

-----

## 五.实验成果与分析

### 1\. **水印不可感知性 (PSNR)**

在我的实验中，当水印嵌入强度 `EMBED_ALPHA` 设置为 **3.0** 时，原始图片与含水印图片之间的 PSNR 值为 **35.99 dB**。

  * **分析**: 这个 PSNR 值表明水印的不可感知性表现**一般**。通常，PSNR 高于 35dB 被认为是人眼难以察觉的。如果肉眼能明显看到水印痕迹，建议适当降低 `EMBED_ALPHA`。

### 2\. **水印鲁棒性 (NCC)**

下表展示了不同攻击类型下，提取出的水印与原始水印的 NCC 值。

| 攻击类型 | NCC 值 |
| :--- | :--- |
| **无攻击 (基准)** | **0.27** |
| 水平翻转 (Flip Horizontal) | 0.29 |
| 垂直翻转 (Flip Vertical) | 0.21 |
| 水平垂直翻转 (Flip HV) | 0.23 |
| 平移 (+20, +0) | 0.31 |
| 平移 (+0, +20) | 0.33 |
| 平移 (+20, +20) | 0.33 |
| 旋转 (5 度) | 0.22 |
| 旋转 (15 度) | 0.24 |
| **裁剪 (并缩放回原尺寸)** | **0.23** |
| 亮度调整 (alpha=1.2) | 0.24 |
| 亮度调整 (alpha=0.8) | 0.27 |
| 亮度调整 (+30) | 0.26 |
| 亮度调整 (-30) | 0.27 |
| JPEG 压缩 (质量 90) | 0.16 |
| JPEG 压缩 (质量 75) | 0.12 |
| JPEG 压缩 (质量 50) | 0.10 |
| JPEG 压缩 (质量 25) | 0.09 |

**详细分析与讨论**:

  * **对几何攻击的鲁棒性**: **翻转、平移和旋转**等几何攻击对水印的影响尤为显著。其中，旋转（NCC 值为 0.22-0.24）和裁剪（NCC 值为 0.23）对水印是**毁灭性的**，因为这些操作破坏了图片的分块结构和频率域特征。
  * **对信号处理攻击的鲁棒性**: **亮度/对比度调整**（NCC 值为 0.24-0.27）对水印的影响较小。然而，**JPEG 压缩**对水印的破坏力非常大。随着压缩质量从 90 降至 25，NCC 值从 0.16 急剧下降到 0.09，这表明在当前参数设置下，水印信息在有损压缩中损失严重。
  * **结论**: 本次实验结果表明，该水印算法的鲁棒性普遍较低，所有测试攻击下的 NCC 值均在 0.09 到 0.33 之间。为了提高水印的鲁棒性，需要重点优化水印的嵌入强度（`EMBED_ALPHA`）以及考虑更复杂的嵌入策略。

-----

## 六.挑战与未来改进方向

### 遇到的挑战

  * **鲁棒性与不可感知性的平衡**: 在保持 PSNR 尚可的情况下，如何提升普遍较低的 NCC 值，是当前面临的主要挑战。
  * **几何攻击的固有局限性**: 简单的 DCT 水印对旋转和裁剪等几何攻击不具备抵抗能力。

### 未来改进方向

  * **调整 `EMBED_ALPHA`**: 鉴于目前较低的 NCC 值，首要任务是**增大 `EMBED_ALPHA`**，以提高水印的嵌入强度，从而增强其抵抗攻击的能力。
  * **增强对几何攻击的鲁棒性**: 探索 **DWT** 或 **SVD** 等其他变换域水印算法，它们可能对几何变换有更好的抵抗力。
  * **优化嵌入策略**: 采用**自适应水印**，根据图像的局部纹理和复杂度动态调整嵌入强度。